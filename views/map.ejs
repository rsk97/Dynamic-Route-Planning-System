<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../public/img/apple-icon.png">
    <link rel="icon" type="image/png" href="../public/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Traffic Management System</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <!-- CSS Files -->
    <link href="../public/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../public/css/now-ui-dashboard.css?v=1.0.1" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="../public/demo/demo.css" rel="stylesheet" />
</head>

<body class="">
    <div class="wrapper ">
        <div class="sidebar" data-color="orange">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="blue | green | orange | red | yellow"
    -->
            <div class="logo">

                    Traffic Management System
                
            </div>
            <div class="sidebar-wrapper">
                <ul class="nav">
                    <li>
                        <a href="/dashboard">
                            <i class="now-ui-icons design_app"></i>
                            <p>Dashboard</p>
                        </a>
                    </li>
                    <li class="active">
                        <a href="/maps">
                            <i class="now-ui-icons location_map-big"></i>
                            <p>Maps</p>
                        </a>
                    </li>
                    <li>
                        <a href="/tables">
                            <i class="now-ui-icons design_bullet-list-67"></i>
                            <p>Table List</p>
                        </a>
                    </li>
					<li>
                        <a href="/location">
                            <i class="now-ui-icons design_bullet-list-67"></i>
                            <p>Location</p>
                        </a>
                    </li>
                    <li>

                    </li>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <nav class="navbar navbar-expand-lg navbar-transparent  navbar-absolute bg-primary fixed-top">
                <div class="container-fluid">
                    <div class="navbar-wrapper">
                        <div class="navbar-toggle">
                            <button type="button" class="navbar-toggler">
                                <span class="navbar-toggler-bar bar1"></span>
                                <span class="navbar-toggler-bar bar2"></span>
                                <span class="navbar-toggler-bar bar3"></span>
                            </button>
                        </div>
                        <a class="navbar-brand" href="#pablo">Maps</a>
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar navbar-kebab"></span>
                        <span class="navbar-toggler-bar navbar-kebab"></span>
                        <span class="navbar-toggler-bar navbar-kebab"></span>
                    </button>
                  <!--  <div class="collapse navbar-collapse justify-content-end" id="navigation">
                        <form>
                            <div class="input-group no-border">
                                <input type="text" value="" class="form-control" placeholder="Search...">
                                <span class="input-group-addon">
                                    <i class="now-ui-icons ui-1_zoom-bold"></i>
                                </span>
                            </div>
                        </form>
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="#pablo">
                                    <i class="now-ui-icons media-2_sound-wave"></i>
                                    <p>
                                        <span class="d-lg-none d-md-block">Stats</span>
                                    </p>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="now-ui-icons location_world"></i>
                                    <p>
                                        <span class="d-lg-none d-md-block">Some Actions</span>
                                    </p>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                    <a class="dropdown-item" href="#">Action</a>
                                    <a class="dropdown-item" href="#">Another action</a>
                                    <a class="dropdown-item" href="#">Something else here</a>
                                </div>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#pablo">
                                    <i class="now-ui-icons users_single-02"></i>
                                    <p>
                                        <span class="d-lg-none d-md-block">Account</span>
                                    </p>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div> -->
            </nav>

            <div class="panel-header panel-header-sm">
            </div>
            <div class="content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card ">
                            <div class="card-header ">
                                Google Maps
                            </div>
                            <div class="card-body ">
                                <div id="map" class="map"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<!--   Core JS Files   -->
<script src="../public/js/core/jquery.min.js"></script>
<script src="../public/js/core/popper.min.js"></script>
<script src="../public/js/core/bootstrap.min.js"></script>
<script src="../public/js/plugins/perfect-scrollbar.jquery.min.js"></script>
<!-- Chart JS -->
<script src="../public/js/plugins/chartjs.min.js"></script>
<!--  Notifications Plugin    -->
<script src="../public/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
<script src="../public/js/now-ui-dashboard.js?v=1.0.1"></script>
<!-- Now Ui Dashboard DEMO methods, don't include it in your project! -->
<script src="../public/demo/demo.js"></script>
<script src="/socket.io/socket.io.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
 <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNsvu6Xd6zZcSr2TU5j5MdeQA141v28PA&callback=initMap">
    </script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script>
      var X =  {'lat': 13.549461, 'lng': 79.999541};
      var Y =  {'lat': 13.555201, 'lng': 80.026427};
		var coord = [{'lat': 13.555216, 'lon': 80.027301},{'lat': 13.560786, 'lon': 80.026996},{'lat': 13.561295, 'lon': 80.023782},{'lat': 13.557910, 'lon': 80.018976}
,{'lat': 13.554012, 'lon': 80.013900},{'lat': 13.553478, 'lon': 80.011429},{'lat': 13.551799, 'lon': 80.007822},
{'lat': 13.551002, 'lon': 80.005999},{'lat': 13.549593, 'lon': 80.003663},{'lat': 13.548192, 'lon': 80.000188}];
var curloc = {'lat': 13.555216, 'lon': 80.027301};
var map;
       $(function () {
      var socket = io();
      socket.on('changeroutes', function(msg){
        console.log(msg);
        console.log("RECEIVED");
        X = {'lat': msg.lat1,'lng': msg.lon1};
        Y = {'lat': msg.lat2,'lng': msg.lon2};
        initMap();
      });
      });
	var uluru = {lat : 13.549461, lng: 79.999541}
	 $(function () {
		var socket = io();
		socket.on('changelocation', function(msg){
		  	console.log(msg);
			console.log("RECEIVED");
			marker.setMap(map);
            marker2.setMap(map);
   		    moveBus( map, marker ,msg, msg.time);
		});
	  });      
	function moveBus( map, marker, msg, time) {
	var lower = 600;
	var upper = 700;
	var mini  = 101010.0;
	for(var i=0;i<10;i++){
		var xdif = msg.lat - coord[i].lat;
		var ydif = msg.lon - coord[i].lon;
		mini = Math.min(mini,(xdif*xdif + ydif*ydif));
	}
	console.log(mini);
	if(mini >= 0.0004 && time >= lower && time <= upper)
		marker.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png');
	else
		marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');

    marker2.setIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png');
    marker2.setPosition( new google.maps.LatLng( msg.clat, msg.clon ) );
    console.log("HERE");
    marker.setPosition( new google.maps.LatLng( msg.lat, msg.lon ) );
    map.panTo( new google.maps.LatLng( msg.lat, msg.lon ) );

};
         
      function initMap() {
         var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer;
         map = new google.maps.Map(document.getElementById('map'), {
          zoom: 7,
          center: {lat: 41.85, lng: -87.65}
        });
	marker = new google.maps.Marker({
		      position: uluru,
		      map: map
		    });
    marker2 = new google.maps.Marker({
              position: uluru,
              map: map
            });
    marker2.setIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png');
    
   
        directionsDisplay.setMap(map);
        calculateAndDisplayRoute(directionsService, directionsDisplay,X,Y);
      }

      function calculateAndDisplayRoute(directionsService, directionsDisplay,X,Y) {
        directionsService.route({
          origin: {lat: X.lat, lng : X.lng},
          destination: {lat: Y.lat, lng: Y.lng},
          travelMode: 'DRIVING'
        }, function(response, status) {
          if (status === 'OK') {
            directionsDisplay.setDirections(response);
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
      }
    </script>
    
<script>
    $(document).ready(function() {
        // Javascript method's body can be found in public/js/demos.js
       ;
    });
</script>

</html>	
